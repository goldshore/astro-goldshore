---
import { getCollection } from 'astro:content';
import DocsSearch from './DocsSearch.astro';

const { currentSlug } = Astro.props;
const pages = await getCollection('docs');

// Sort by optional "order" key
pages.sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));

function getHref(slug: string) {
  return slug === 'index' ? '/developer/docs' : `/developer/docs/${slug}`;
}
---

<aside class="gs-card docs-sidebar" aria-label="Documentation navigation">
  <div class="search-container">
    <DocsSearch />
  </div>

  <h3 class="section-title"><span>â—Ž</span>Documentation</h3>
  <ul class="docs-nav">
    {pages.map((p) => (
      <li>
        <a
          href={getHref(p.slug)}
          class={currentSlug === p.slug ? 'active' : ''}
          aria-current={currentSlug === p.slug ? 'page' : undefined}
        >
          {p.data.title}
        </a>
      </li>
    ))}
  </ul>
</aside>

<style>
  .docs-sidebar { position: sticky; top: var(--gs-space-6); align-self: start; }
  .docs-nav { list-style: none; padding-left: 0; display: flex; flex-direction: column; gap: var(--gs-space-1); }

  .docs-nav a {
    color: var(--gs-color-subtle);
    text-decoration: none;
    transition: all 0.2s ease;
    display: block;
    padding: var(--gs-space-1) var(--gs-space-2);
    border-left: 2px solid transparent;
    font-size: 0.95rem;
  }

  .docs-nav a:hover {
    color: var(--gs-color-text);
    background: rgba(255,255,255,0.03);
  }

  .docs-nav a.active {
    color: #22d3ee;
    border-left-color: #22d3ee;
    font-weight: 500;
    background: linear-gradient(90deg, rgba(34, 211, 238, 0.05) 0%, transparent 100%);
  }

  .search-container {
    margin-bottom: var(--gs-space-6);
  }

  .section-title {
    margin-top: 0;
    margin-bottom: var(--gs-space-4);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gs-color-subtle);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  @media (max-width: 900px) {
    .docs-sidebar { position: relative; top: 0; }
  }
</style>
