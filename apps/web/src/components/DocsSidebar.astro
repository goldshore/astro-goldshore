---
import { getCollection } from 'astro:content';
import DocsSearch from './DocsSearch.astro';

const { currentSlug } = Astro.props;
const pages = await getCollection('docs');

// Sort by optional "order" key
pages.sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));

function getHref(slug: string) {
  return slug === 'index' ? '/developer/docs' : `/developer/docs/${slug}`;
}
---

<aside class="gs-card docs-sidebar" aria-label="Documentation navigation">
  <h3 class="section-title"><span aria-hidden="true">◎</span>Documentation</h3>
  <div class="search-container">
    <DocsSearch />
  </div>

  <h3 class="section-title"><span>◎</span>Documentation</h3>
  <ul class="docs-nav">
    {pages.map((p) => (
      <li>
        <a
          href={getHref(p.slug)}
          class={currentSlug === p.slug ? 'active' : ''}
          aria-current={currentSlug === p.slug ? 'page' : undefined}
        >
          {p.data.title}
        </a>
      </li>
    ))}
  </ul>
</aside>

<style>
  .docs-sidebar { position: sticky; top: var(--gs-space-6); align-self: start; }
  .docs-nav { list-style: none; padding-left: 0; display: flex; flex-direction: column; gap: var(--gs-space-2); }
  .docs-nav a {
    display: block;
    color: var(--gs-color-subtle);
    text-decoration: none;
    transition: all 0.2s ease;
    border-left: 2px solid transparent;
    padding-left: 0.75rem;
  }
  .docs-nav a:hover { color: var(--gs-color-text); border-left-color: var(--gs-color-border); }
  .docs-nav a.active {
    color: var(--gs-color-primary);
    border-left-color: var(--gs-color-primary);
    background: var(--gs-color-primary-soft);
    border-radius: 0 var(--gs-radius-xs) var(--gs-radius-xs) 0;
  }

  .section-title {
    margin-top: 0;
    margin-bottom: var(--gs-space-4);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gs-color-subtle);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  @media (max-width: 900px) {
    .docs-sidebar { position: relative; top: 0; }
  }
</style>
