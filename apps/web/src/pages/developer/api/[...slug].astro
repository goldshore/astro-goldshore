---
import Layout from '../../../layouts/BaseLayout.astro';
import ApiSidebar from '../../../components/ApiSidebar.astro';
import ApiEndpoint from '../../../components/ApiEndpoint.astro';
import openapi from '../../../data/v1.json';

// Bolt Optimization: Enable Static Site Generation (SSG) for API docs.
// This improves Time to First Byte (TTFB) significantly by serving pre-rendered HTML via CDN
// instead of executing the render logic on every request (SSR).
export const prerender = true;

// Generate static paths based on the OpenAPI specification.
// This ensures all documented endpoints are pre-built.
export function getStaticPaths() {
  const paths = Object.keys(openapi.paths).map((path) => ({
    params: { slug: path.replace(/^\//, '') },
  }));

  return [
    { params: { slug: undefined } }, // Handle the index route (/developer/api)
    ...paths
  ];
}

const { slug } = Astro.params;
const endpoint = slug || '';
---

<Layout title="API Reference">
  <div class="api-container">
    <ApiSidebar openapi={openapi} />
    <main class="api-main">
      <ApiEndpoint openapi={openapi} endpoint={endpoint} />
    </main>
  </div>
</Layout>

<style>
  .api-container {
    display: flex;
    min-height: 100vh;
    background: var(--color-surface-1);
  }
  .api-main {
    flex: 1;
    padding: var(--space-4);
  }
</style>
