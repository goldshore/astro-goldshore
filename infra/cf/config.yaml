account_id_env: CF_ACCOUNT_ID
zone_id_env: CF_ZONE_ID

projects:
  pages:
    - name: goldshore-web
      output_dir: apps/web/dist
      max_daily_deploys: 6
      require_checks: ["smoke", "lighthouse"]
      skip_if_paths_only:
        - "^docs/.*"
        - "^scripts/.*"
        - "^README.md$"
    - name: goldshore-admin
      output_dir: apps/admin/dist
      max_daily_deploys: 6
      require_checks: ["smoke", "lighthouse"]
      skip_if_paths_only:
        - "^docs/.*"
        - "^scripts/.*"
        - "^README.md$"

  workers:
    - script: goldshore-api
      entry: apps/api-worker/dist/index.js
      routes:
        - pattern: "api.goldshore.org/*"
          zone: goldshore.org
      max_daily_deploys: 10
      require_checks: ["smoke"]
      skip_if_paths_only:
        - "^docs/.*"
        - "^README.md$"

guards:
  dedupe_concurrency_key: "cf-deploy"
  cool_down_minutes: 15
  backoff_ms: 250
  backoff_factor: 2

tests:
  smoke:
    - url: "https://goldshore.org/"
      expect_status: 200
      timeout_ms: 5000
    - url: "https://api.goldshore.org/health"
      expect_status: 200
      timeout_ms: 4000
  lighthouse:
    url: "https://goldshore.org/"
    budget:
      performance: 0.85
      tti_ms: 4000
